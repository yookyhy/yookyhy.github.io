import{s as o,F as m,d,e as v}from"./index-pIZbQTh6.js";const f=async t=>{if(t instanceof m){const e=await t.context.json();console.log("Function returned an error",e)}else t instanceof d?console.log("Relay error:",t.message):t instanceof v&&console.log("Fetch error:",t.message)},g=async()=>{const{data:t,error:e}=await o.functions.invoke("set-default-user-level");return e?(f(e),null):t.default_user_level},_=async()=>{const{data:t,error:e}=await o.functions.invoke("set-default-user-coin");return e?(f(e),null):t.default_user_coin},L={1:{name:"Lv.1 Moment",minCoins:0,maxCoins:9999},2:{name:"Lv.2 Minute",minCoins:1e4,maxCoins:24999},3:{name:"Lv.3 Hour",minCoins:25e3,maxCoins:49999},4:{name:"Lv.4 Day",minCoins:5e4,maxCoins:99999},5:{name:"Lv.5 Era",minCoins:1e5,maxCoins:1/0}},y=t=>{const{user_metadata:e}=t;if(!(e!=null&&e.trumeet_user))return!1;const n=e.trumeet_user,r=["name","email","bio","avatar","level","coins","joined"];for(const s of r)if(!(s in n))return!1;return!(typeof n.name!="string"||typeof n.email!="string"||typeof n.bio!="string"||typeof n.avatar!="string"||typeof n.level!="number"||typeof n.coins!="number"||typeof n.joined!="string"||n.coins<0)},C=async t=>{const{user_metadata:e}=t,n=(e==null?void 0:e.name)||"신규 사용자",r=(e==null?void 0:e.avatar_url)||"/sgt_yang_profile.jpg",s=t.email,i=t.created_at;let a=1e4,l=2;const c=await _();c?a=c[0].coins:alert("코인 시스템 등록 실패. 관리자에게 문의하세요");const u=await g();return u?l=u[0].level:alert("레벨 시스템 등록 실패. 관리자에게 문의하세요"),{name:n,email:s,bio:"시간을 함께 나누는 사람입니다.",avatar:r,level:l,coins:a,joined:i}},E=async t=>{const{error:e}=await o.auth.updateUser({data:{trumeet_user:t}});return e?(alert("trumeet user 정보 업데이트 실패: "+e.message),!1):!0},F=async t=>{if(y(t)){const e={...t.user_metadata.trumeet_user},{data:n,error:r}=await o.from("user_coins").select("coins").eq("user_id",t.id).single();if(r)return console.error("Error fetching user coins:",r),e;e.coins=n.coins;const{data:s,error:i}=await o.from("user_levels").select("level").eq("user_id",t.id).single();return i?(console.error("Error fetching user levels:",i),e):(e.level=s.level,{...e,id:t.id})}else{const e=await C(t);return await E(e)?{...e,id:t.id}:void 0}};export{L,F as g};
