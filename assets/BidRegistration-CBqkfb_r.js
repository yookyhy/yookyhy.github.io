import{u as S,b as D,r as b,j as e,s as y}from"./index-mT-WyXZ5.js";function E(){const c=S(),j=D(),g=new URLSearchParams(j.search),i=g.get("menu"),v=g.get("type"),[a,d]=b.useState({type:v||"bidding",category:"",title:"",description:"",time_duration:"",schedule_info:"",start_price:"",deadline_at:"",status:"active"}),[s,p]=b.useState({}),[u,h]=b.useState(!1),_=[{value:"멘토링",label:"멘토링"},{value:"스터디",label:"스터디"},{value:"소모임",label:"소모임"}],N=[{value:"30분",label:"30분"},{value:"1시간",label:"1시간"},{value:"1시간 30분",label:"1시간 30분"},{value:"2시간",label:"2시간"},{value:"2시간 30분",label:"2시간 30분"},{value:"3시간",label:"3시간"},{value:"기타",label:"기타"}],m=(t,r)=>{switch(t){case"category":return r?"":"카테고리를 선택해주세요.";case"title":return r.trim()?r.trim().length>=5?"":"제목은 5자 이상 입력해주세요.":"거래 제목을 입력해주세요.";case"time_duration":return r?"":"거래 시간을 선택해주세요.";case"schedule_info":return r.trim()?"":"예상 일정을 입력해주세요.";case"start_price":{const n=parseInt(r);return r&&n>0?"":"시작 가격을 올바르게 입력해주세요. (1 이상의 숫자)"}case"deadline_at":return r?new Date(r)>new Date?"":"마감 시간은 현재 시간보다 이후여야 합니다.":"마감 시간을 선택해주세요.";case"description":return"";default:return""}},l=t=>{const{name:r,value:n}=t.target;d(x=>({...x,[r]:n}));const o=m(r,n);p(x=>({...x,[r]:o}))},w=()=>{const t={};return Object.keys(a).forEach(r=>{if(r!=="type"&&r!=="status"&&r!=="description"){const n=m(r,a[r]);n&&(t[r]=n)}}),p(t),Object.keys(t).length===0},$=async t=>{if(t.preventDefault(),!!w()){h(!0);try{await C(a),alert("시간 입찰이 성공적으로 등록되었습니다!"),c(i?`/bids?menu=${i}`:"/bids")}catch(r){console.error("Submit error:",r),alert("등록 중 오류가 발생했습니다. 다시 시도해주세요.")}finally{h(!1)}}},C=async t=>{const{data:r,error:n}=await y.auth.getUser();n&&(alert("사용자 정보 오류"),c("/")),console.log(r);const{error:o}=await y.from("time_bids").insert({user_id:r.user.id,category:t.category,deadline_at:t.deadline_at,description:t.description,schedule_info:t.schedule_info,start_price:t.start_price,time_duration:t.time_duration,title:t.title,type:t.type,status:t.status});console.log(o)},f=()=>Object.keys(a).every(t=>t==="type"||t==="status"||t==="description"?!0:!m(t,a[t]))&&Object.entries(a).every(([t,r])=>t==="description"?!0:r.toString().trim());return e.jsxs("div",{className:"p-4 max-w-md mx-auto font-noto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"시간 입찰 등록"}),e.jsx("button",{onClick:()=>c(i?`/bids?menu=${i}`:"/bids"),className:"w-8 h-8 flex items-center justify-center text-slate-500 hover:text-slate-700 hover:bg-slate-200 rounded-lg transition-colors bg-white border border-slate-200",children:"✕"})]}),e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"거래 유형"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>d(t=>({...t,type:"bidding"})),className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium ${a.type==="bidding"?"bg-sky-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"⏰ 판매 (비딩)"}),e.jsx("button",{type:"button",onClick:()=>d(t=>({...t,type:"reverse"})),className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium ${a.type==="reverse"?"bg-emerald-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"💸 구매 (역비딩)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"카테고리"}),e.jsxs("select",{name:"category",value:a.category,onChange:l,className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${s.category?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"카테고리를 선택해주세요"}),_.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),s.category&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"거래 제목"}),e.jsx("input",{type:"text",name:"title",value:a.title,onChange:l,placeholder:"예: React 입문 멘토링",className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${s.title?"border-red-500":"border-gray-300"}`}),s.title&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"상세 설명 (선택사항)"}),e.jsx("textarea",{name:"description",value:a.description,onChange:l,placeholder:"상세한 설명을 입력해주세요.",rows:"3",className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${s.description?"border-red-500":"border-gray-300"}`}),s.description&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"거래 시간"}),e.jsxs("select",{name:"time_duration",value:a.time_duration,onChange:l,className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${s.time_duration?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"시간을 선택해주세요"}),N.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),s.time_duration&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.time_duration})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"예상 일정"}),e.jsx("input",{type:"text",name:"schedule_info",value:a.schedule_info,onChange:l,placeholder:"예: 7/4 19:00~22:00 사이",className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${s.schedule_info?"border-red-500":"border-gray-300"}`}),s.schedule_info&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.schedule_info})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"시작 가격 (모먼트)"}),e.jsx("input",{type:"number",name:"start_price",value:a.start_price,onChange:l,placeholder:"예: 5",min:"1",className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${s.start_price?"border-red-500":"border-gray-300"}`}),s.start_price&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.start_price})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"입찰 마감 시간"}),e.jsx("input",{type:"datetime-local",name:"deadline_at",value:a.deadline_at,onChange:l,className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${s.deadline_at?"border-red-500":"border-gray-300"}`}),s.deadline_at&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.deadline_at})]}),e.jsx("button",{type:"submit",disabled:!f()||u,className:`w-full py-3 px-4 rounded-lg font-medium text-white ${f()&&!u?"bg-blue-500 hover:bg-blue-600":"bg-gray-300 cursor-not-allowed"}`,children:u?"등록 중...":"등록하기"})]})]})}export{E as default};
